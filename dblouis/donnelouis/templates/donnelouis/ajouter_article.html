{% extends 'donnelouis/base.html' %}
{% load static %}

{% block title %}Ajouter un article - L'Air du Vol¬Æ{% endblock %}

{% block content %}
<div class="add-content-container">
  <div class="add-content-card">
    <div class="add-content-header">
      <h1>‚úçÔ∏è Ajouter un nouvel article</h1>
      <p>Remplissez le formulaire ci-dessous pour cr√©er votre article</p>
    </div>

    <!-- Messages -->
    {% if messages %}
      <div class="messages">
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Formulaire -->
    <form method="POST" class="add-content-form" id="article-form">
      {% csrf_token %}

      <!-- SECTION 1: Informations de base -->
      <div class="form-section">
        <h2 class="section-title">üìã Informations de base</h2>
        
        <div class="form-row">
          <div class="form-group">
            <label for="id_titre">Titre de l'article:</label>
            {{ form.titre }}
            {% if form.titre.errors %}<span class="error">{{ form.titre.errors.0 }}</span>{% endif %}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="id_categorie">Cat√©gorie:</label>
            {{ form.categorie }}
            {% if form.categorie.errors %}<span class="error">{{ form.categorie.errors.0 }}</span>{% endif %}
          </div>
          <div class="form-group">
            <label for="id_date_publication">Date de publication:</label>
            {{ form.date_publication }}
            {% if form.date_publication.errors %}<span class="error">{{ form.date_publication.errors.0 }}</span>{% endif %}
          </div>
        </div>

        <div class="form-group">
          <label for="id_resume">R√©sum√©:</label>
          {{ form.resume }}
          {% if form.resume.errors %}<span class="error">{{ form.resume.errors.0 }}</span>{% endif %}
        </div>

        <div class="form-group">
          <label for="id_image_principale">URL de l'image principale:</label>
          {{ form.image_principale }}
          {% if form.image_principale.errors %}<span class="error">{{ form.image_principale.errors.0 }}</span>{% endif %}
        </div>
      </div>

      <!-- SECTION 2: Th√®me 1 -->
      <div class="form-section">
        <h2 class="section-title">üéØ Th√®me 1</h2>
        
        <div class="form-group">
          <label for="id_theme1_titre">Titre du th√®me:</label>
          {{ form.theme1_titre }}
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="id_theme1_section_a_titre">Section A - Titre:</label>
            {{ form.theme1_section_a_titre }}
          </div>
          <div class="form-group">
            <label for="id_theme1_section_b_titre">Section B - Titre:</label>
            {{ form.theme1_section_b_titre }}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="id_theme1_section_a_texte">Section A - Contenu:</label>
            {{ form.theme1_section_a_texte }}
          </div>
          <div class="form-group">
            <label for="id_theme1_section_b_texte">Section B - Contenu:</label>
            {{ form.theme1_section_b_texte }}
          </div>
        </div>
      </div>

      <!-- SECTION 3: Th√®me 2 -->
      <div class="form-section">
        <h2 class="section-title">üéØ Th√®me 2</h2>
        
        <div class="form-group">
          <label for="id_theme2_titre">Titre du th√®me:</label>
          {{ form.theme2_titre }}
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="id_theme2_section_a_titre">Section A - Titre:</label>
            {{ form.theme2_section_a_titre }}
          </div>
          <div class="form-group">
            <label for="id_theme2_section_b_titre">Section B - Titre:</label>
            {{ form.theme2_section_b_titre }}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="id_theme2_section_a_texte">Section A - Contenu:</label>
            {{ form.theme2_section_a_texte }}
          </div>
          <div class="form-group">
            <label for="id_theme2_section_b_texte">Section B - Contenu:</label>
            {{ form.theme2_section_b_texte }}
          </div>
        </div>
      </div>

      <!-- SECTION 4: Th√®me 3 -->
      <div class="form-section">
        <h2 class="section-title">üéØ Th√®me 3</h2>
        
        <div class="form-group">
          <label for="id_theme3_titre">Titre du th√®me:</label>
          {{ form.theme3_titre }}
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="id_theme3_section_a_titre">Section A - Titre:</label>
            {{ form.theme3_section_a_titre }}
          </div>
          <div class="form-group">
            <label for="id_theme3_section_b_titre">Section B - Titre:</label>
            {{ form.theme3_section_b_titre }}
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="id_theme3_section_a_texte">Section A - Contenu:</label>
            {{ form.theme3_section_a_texte }}
          </div>
          <div class="form-group">
            <label for="id_theme3_section_b_texte">Section B - Contenu:</label>
            {{ form.theme3_section_b_texte }}
          </div>
        </div>
      </div>

      <!-- SECTION 5: Conclusion -->
      <div class="form-section">
        <h2 class="section-title">‚ú® Conclusion</h2>
        
        <div class="form-group">
          <label for="id_conclusion_titre">Titre de la conclusion:</label>
          {{ form.conclusion_titre }}
        </div>

        <div class="form-group">
          <label for="id_conclusion_texte">Texte de la conclusion:</label>
          {{ form.conclusion_texte }}
        </div>
      </div>

      <!-- SECTION 6: Images -->
      <div class="form-section">
        <h2 class="section-title">üì∏ Galerie d'images</h2>
        <p class="section-help">Vous pouvez ajouter jusqu'√† 5 images pour illustrer votre article</p>
        
        <div id="images-container">
          <!-- Les images seront ajout√©es ici dynamiquement -->
        </div>

        <button type="button" class="btn-add-image" id="btn-add-image">
          ‚ûï Ajouter une image
        </button>
      </div>

      <!-- Boutons d'action -->
      <div class="form-actions">
        <button type="submit" class="btn-submit">üì§ Publier l'article</button>
        <a href="{% url 'liste_articles' %}" class="btn-cancel">‚Üê Annuler</a>
      </div>
    </form>
  </div>
</div>

<style>
.add-content-container {
  padding: 2rem;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
}

.add-content-card {
  background: white;
  border-radius: 1rem;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
  padding: 2.5rem;
  max-width: 1000px;
  margin: 0 auto;
  animation: slideIn 0.5s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.add-content-header {
  text-align: center;
  margin-bottom: 2rem;
  border-bottom: 2px solid #f0f0f0;
  padding-bottom: 1.5rem;
}

.add-content-header h1 {
  font-size: 2rem;
  color: #0A2463;
  margin-bottom: 0.5rem;
}

.add-content-header p {
  color: #64748B;
}

.form-section {
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: #f9fafb;
  border-radius: 0.75rem;
  border-left: 4px solid #0A2463;
}

.section-title {
  font-size: 1.25rem;
  color: #0A2463;
  margin-bottom: 1.5rem;
  font-weight: 600;
}

.section-help {
  font-size: 0.875rem;
  color: #64748B;
  margin-bottom: 1rem;
  font-style: italic;
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-bottom: 1.5rem;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.form-group label {
  font-weight: 600;
  color: #1E293B;
  font-size: 0.95rem;
}

.form-control {
  padding: 0.875rem 1rem;
  border: 2px solid #E2E8F0;
  border-radius: 0.5rem;
  font-size: 1rem;
  font-family: inherit;
  transition: all 0.3s ease;
  width: 100%;
}

.form-control:focus {
  outline: none;
  border-color: #0A2463;
  box-shadow: 0 0 0 3px rgba(10, 36, 99, 0.1);
}

.form-control::placeholder {
  color: #94A3B8;
}

textarea.form-control {
  resize: vertical;
  min-height: 100px;
}

.error {
  color: #dc2626;
  font-size: 0.85rem;
  margin-top: 0.25rem;
}

.image-item {
  background: white;
  border: 2px solid #E2E8F0;
  border-radius: 0.75rem;
  padding: 1.5rem;
  margin-bottom: 1rem;
  position: relative;
}

.image-item-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.image-item-title {
  font-weight: 600;
  color: #0A2463;
}

.btn-remove-image {
  background: #dc2626;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 0.375rem;
  cursor: pointer;
  font-size: 0.875rem;
  transition: background 0.3s ease;
}

.btn-remove-image:hover {
  background: #991B1B;
}

.btn-add-image {
  background: linear-gradient(135deg, #0A2463, #1E3A8A);
  color: white;
  border: none;
  padding: 0.875rem 1.5rem;
  border-radius: 0.5rem;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.95rem;
  transition: all 0.3s ease;
  width: 100%;
}

.btn-add-image:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(10, 36, 99, 0.2);
}

.form-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
  padding-top: 2rem;
  border-top: 2px solid #E2E8F0;
}

.btn-submit {
  flex: 1;
  padding: 1rem;
  background: linear-gradient(135deg, #0A2463, #1E3A8A);
  color: white;
  border: none;
  border-radius: 0.5rem;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.btn-submit:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(10, 36, 99, 0.3);
}

.btn-cancel {
  flex: 1;
  padding: 1rem;
  background: #E2E8F0;
  color: #0A2463;
  text-decoration: none;
  border-radius: 0.5rem;
  font-weight: 600;
  font-size: 1rem;
  text-align: center;
  transition: all 0.3s ease;
  border: none;
  cursor: pointer;
}

.btn-cancel:hover {
  background: #CBD5E1;
  transform: translateY(-2px);
}

.messages {
  margin-bottom: 1.5rem;
}

.alert {
  padding: 1rem;
  border-radius: 0.5rem;
  margin-bottom: 0.75rem;
  font-size: 0.95rem;
}

.alert-error {
  background-color: #FEE2E2;
  color: #991B1B;
  border: 1px solid #FECACA;
}

.alert-success {
  background-color: #DCFCE7;
  color: #166534;
  border: 1px solid #BBF7D0;
}

@media (max-width: 768px) {
  .form-row {
    grid-template-columns: 1fr;
  }

  .form-actions {
    flex-direction: column;
  }

  .add-content-card {
    padding: 1.5rem;
  }

  .add-content-header h1 {
    font-size: 1.5rem;
  }
}
</style>

<script>
let imageCount = 0;
const maxImages = 5;

document.getElementById('btn-add-image').addEventListener('click', () => {
  if (imageCount >= maxImages) {
    alert(`Vous pouvez ajouter au maximum ${maxImages} images`);
    return;
  }

  const container = document.getElementById('images-container');
  const imageItem = document.createElement('div');
  imageItem.className = 'image-item';
  imageItem.innerHTML = `
    <div class="image-item-header">
      <span class="image-item-title">Image ${imageCount + 1}</span>
      <button type="button" class="btn-remove-image" onclick="this.parentElement.parentElement.remove(); imageCount--;">√ó</button>
    </div>
    <div class="form-group">
      <label>URL de l'image:</label>
      <input type="url" name="image_url" class="form-control" placeholder="https://...">
    </div>
    <div class="form-group">
      <label>L√©gende/Description:</label>
      <input type="text" name="legende" class="form-control" placeholder="Description de l'image">
    </div>
    <div class="form-group">
      <label>Ordre d'affichage:</label>
      <input type="number" name="ordre" class="form-control" value="${imageCount}" min="0">
    </div>
  `;
  container.appendChild(imageItem);
  imageCount++;
});
</script>
{% endblock %}
